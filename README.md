# story-song

Маркетинговый лендинг для заказа персональных песен.

## Деплой через Docker Compose

Стек состоит из трёх контейнеров: PHP-FPM с приложением, Nginx в роли фронтенд-сервера и Certbot, который выпускает и продлевает бесплатные SSL-сертификаты Let's Encrypt.

### Требования

- Docker Engine 20.10+
- Docker Compose plugin 2.0+
- Домен, указывающий на сервер, где разворачивается приложение

### Настройка окружения

1. Скопируйте файл `.env.example` в `.env` и укажите боевые значения:

   ```bash
   cp .env.example .env
   ```

2. Обновите переменные в `.env`:

   - `DOMAIN` — ваш домен (например, `music.example.com`).
   - `EMAIL` — контактная почта для уведомлений Let's Encrypt.
   - При необходимости добавьте токены `TELEGRAM_BOT_TOKEN` и `TELEGRAM_CHAT_ID`, чтобы форма отправляла заявки в Telegram.

### Запуск

1. Выполните скрипт деплоя:

   ```bash
   ./deploy.sh
   ```

   Скрипт проверит `.env`, соберёт образ PHP-приложения и запустит контейнеры `php` и `nginx`.

2. Если сертификата ещё нет, скрипт автоматически запросит его через Certbot по HTTP-челленджу, обновит конфигурацию Nginx и перезапустит сервер.

3. После успешного выпуска сертификата будет запущен контейнер `certbot-renew`, который каждые 12 часов проверяет необходимость продления.

### Полезные команды

- Перезапустить стек после обновления кода:

  ```bash
  docker compose up -d --build php nginx
  ```

- Запустить сервис продления сертификатов вручную (например, после остановки):

  ```bash
  docker compose up -d certbot-renew
  ```

- Просмотреть логи Nginx, PHP или Certbot:

  ```bash
  docker compose logs -f nginx
  docker compose logs -f php
  docker compose logs -f certbot-renew
  ```

- Остановить и удалить контейнеры:

  ```bash
  docker compose down
  ```

## Локальный запуск для разработки

Для быстрой проверки интерфейса можно воспользоваться встроенным в PHP веб-сервером:

```bash
php -S localhost:8000
```

После запуска откройте [http://localhost:8000](http://localhost:8000) в браузере.
